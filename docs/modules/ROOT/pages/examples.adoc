= PojoQuery Examples

This page provides practical examples of using PojoQuery.

== Example 1: Basic Select

Fetch all users ordered by last name.

*POJO:*
[source,java]
----
@Table("user")
public class User {
    @Id Long id;
    String firstName;
    String lastName;
    String email;
}
----

*Query:*
[source,java]
----
List<User> users = PojoQuery.build(User.class)
    .addOrderBy("user.lastName ASC")
    .execute(dataSource);
----

== Example 2: Select with Join (`@Link`)

Fetch an article including its author details.

*POJOs:*
[source,java]
----
@Table("article")
public class Article {
    @Id Long id;
    String title;
    Long author_id; // Foreign key
}

public class ArticleWithAuthor extends Article {
    @Link User author; // Links to User based on author_id
}

@Table("user")
public class User {
    @Id Long id;
    String firstName;
    String lastName;
}
----

*Query:*
[source,java]
----
ArticleWithAuthor article = PojoQuery.build(ArticleWithAuthor.class)
    .addWhere("article.id = ?", 123L)
    .execute(dataSource)
    .stream().findFirst().orElse(null);

if (article != null) {
    System.out.println("Author: " + article.author.firstName);
}
----

== Example 3: One-to-Many Relationship (`@Link`)

Fetch an article including a list of its comments.

*POJOs:*
[source,java]
----
@Table("article")
public class Article {
    @Id Long id;
    String title;
}

public class ArticleWithComments extends Article {
    // Assumes 'comment' table has 'article_id' column
    @Link List<Comment> comments;
}

@Table("comment")
public class Comment {
    @Id Long id;
    Long article_id;
    String text;
    Date submitDate;
}
----

*Query:*
[source,java]
----
ArticleWithComments article = PojoQuery.build(ArticleWithComments.class)
    .addWhere("article.id = ?", 456L)
    .addOrderBy("comments.submitDate DESC") // Order comments
    .execute(dataSource)
    .stream().findFirst().orElse(null);

if (article != null) {
    System.out.println("Comments count: " + article.comments.size());
    article.comments.forEach(c -> System.out.println("- " + c.text));
}
----

== Example 4: Aggregation (`@GroupBy`, `@Select`)

Get the count and latest comment date for each article.

*POJO:*
[source,java]
----
@Table("comment") // Query starts from comment table
@GroupBy("comment.article_id") // Group by article
public class ArticleCommentStats {
    @FieldName("article_id") // Map the grouping key
    Long articleId;

    @Select("COUNT(*)")
    Integer commentCount;

    @Select("MAX(submitDate)")
    Date lastCommentDate;
}
----

*Query:*
[source,java]
----
List<ArticleCommentStats> stats = PojoQuery.build(ArticleCommentStats.class)
    .execute(dataSource);

stats.forEach(s -> System.out.println(
    "Article " + s.articleId + ": " + s.commentCount + " comments, last on " + s.lastCommentDate
));
----

== Example 5: Custom SQL Field (`@Select`)

Fetch user with a calculated full name field.

*POJO:*
[source,java]
----
@Table("user")
public class UserWithFullName {
    @Id Long id;
    String firstName;
    String lastName;

    @Select("CONCAT(firstName, ' ', lastName)") // Database-specific function
    String fullName;
}
----

*Query:*
[source,java]
----
UserWithFullName user = PojoQuery.build(UserWithFullName.class)
    .addWhere("user.id = ?", 789L)
    .execute(dataSource)
    .stream().findFirst().orElse(null);

if (user != null) {
    System.out.println("Full Name: " + user.fullName);
}
----

== Example 6: Insert Operation

Insert a new user record.

*POJO:* (Same as Example 1)

*Operation:*
[source,java]
----
User newUser = new User();
newUser.firstName = "Alice";
newUser.lastName = "Wonder";
newUser.email = "alice@example.com";

PojoQuery.insert(dataSource, newUser);
// newUser.id is now populated if it was auto-generated
System.out.println("New user ID: " + newUser.id);
----

== Example 7: Update Operation

Update an existing user's email.

*POJO:* (Same as Example 1)

*Operation:*
[source,java]
----
// Assume 'userToUpdate' was fetched previously
userToUpdate.email = "alice.w@example.com";
int updatedRows = PojoQuery.update(dataSource, userToUpdate);
System.out.println("Rows updated: " + updatedRows);
----
